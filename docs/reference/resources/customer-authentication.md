# Customer Authentication <small>`:::js api.customerAuthentication`</small>

> Member of [`RebillyAPI`][goto-rebillyapi]

Authenticate your customers within your Rebilly integration. This feature is useful for creating self-service portals for your customers. 

## getAuthOptions
<div class="method"><code><strong>getAuthOptions</strong>() -> <span class="return">{Member}</span></code></div>

Get global customer authentication options.

**Example**

```js
const options = await api.customerAuthentication.getAuthOptions();
console.log(options.fields.credentialTtl);
```


**Returns**

A member exposing the authentication options fields.

Type [`Member`][goto-member]


**API Spec**

See the [detailed API spec][1]{: target="_blank"} for all payload fields and response data.

## updateAuthOptions
<div class="method"><code><strong>updateAuthOptions</strong>({<span class="prop">data</span>}) -> <span class="return">{Member}</span></code></div>

Update the global customer authentication options. You can modify the TTL (in seconds) for the credentials, authorization tokens and reset password tokens, or the password regular expression pattern use for validation.

**Example**

```js
// first set the properties for the authentication options
const data = {
    passwordPattern: null,
    credentialTtl: 10,
    authTokenTtl: 20,
    resetTokenTtl: 30
};

const options = await api.customerAuthentication.updateAuthOptions({data});
console.log(options.fields.credentialTtl);
```

**Returns**

A member exposing the updated custom field fields.

Type [`Member`][goto-member]


**API Spec**

See the [detailed API spec][2]{: target="_blank"} for all payload fields and response data.



## getAllAuthTokens

<div class="method"><code><strong>getAllAuthTokens</strong>({<span class="prop">limit</span><span class="optional">opt</span>, <span class="prop">offset</span><span class="optional">opt</span>}) -> <span class="return">{Collection}</span></code></div>

Get a collection of authentication tokens created for your customers. Each entry will be a member.

!!! info "Token Generation"
    Tokens are generated by the [customerAuthentication.login][goto-login] method.


**Example**

```js
// all parameters are optional
const firstCollection = await api.customerAuthentication.getAllAuthTokens();

// alternatively you can specify one or more of them
const params = {limit: 20, offset: 100}; 
const secondCollection = await api.customerAuthentication.getAllAuthTokens(params);

// access the collection items, each item is a Member
secondCollection.items.forEach(token => console.log(token.fields.username));
```

**Parameters**


| Name | Type | Attribute | Description |
| - | - | - | - |
| limit | number | Optional | The amount of members to return per request.<br>Defaults to `100`. |
| offset | number | Optional | Member index from which to start returning results. <br>Defaults to `0`. |


**Returns**

A collection of authentication tokens.

Type [`Collection`][goto-collection]


**API Spec**

See the [detailed API spec][3]{: target="_blank"} for all payload fields and response data.

## verify
<div class="method"><code><strong>verify</strong>({<span class="prop">token</span>}) -> <span class="return">{Member}</span></code></div>

Verify the validity of an authentication token. If valid the response will contain all the token fields.


**Example**

```js
const token = 'dcf6e32f2daee457a1db8ce5fdfbe200';
const verification = await api.customerAuthentication.verify({token});
// if the the token is valid then no error will be thrown
console.log(verification.reponse.status) // 200
```

**Returns**

A member exposing the token fields.

Type [`Member`][goto-member]


**API Spec**

See the [detailed API spec][4]{: target="_blank"} for all payload fields and response data.

## login
<div class="method"><code><strong>login</strong>({<span class="prop">data</span>}) -> <span class="return">{Member}</span></code></div>

Login a customer into Rebilly and retrieve the authentication token being generated.

Optionally you can provide the expired time of the session using `expiredTime` as a `datetime` in the future.

!!! info "Similar Account Method"
    This method is similar to [account.signIn][goto-account-login] but unlike it, it requires to be authorized in the API and will not return a JWT session token.
    
> See [customerAuthentication.logout][goto-logout]

**Example**

```js
const data = {
    username: 'foobar',
    password: 'fuubar'
    
    // optionally you can define an `expiredTime` to 
    // limit the duration of the session token
    
    //expiredTime: '2017-09-18T19:17:39Z'
};
const session = await api.customerAuthentication.login({data});
console.log(session.fields.token);
```

**Returns**

A member exposing the token fields.

Type [`Member`][goto-member]


**API Spec**

See the [detailed API spec][5]{: target="_blank"} for all payload fields and response data.

## logout
<div class="method"><code><strong>logout</strong>({<span class="prop">token</span>}) -> <span class="return">{Member}</span></code></div>

Logout the customer and invalidate his session token.


**Example**

```js
const token = 'dcf6e32f2daee457a1db8ce5fdfbe200';
const request = await api.customerAuthentication.logout({token});

// the request does not return any fields but
// you can confirm the success using the status code
console.log(request.response.status); // 204
```

**Returns**

An empty member without fields. Check the `response` property to validate the expected status code.

Type [`Member`][goto-member]


**API Spec**

See the [detailed API spec][6]{: target="_blank"} for all payload fields and response data.

[goto-rebillyapi]: ../rebilly-api
[goto-collection]: ../types/collection
[goto-member]: ../types/member
[goto-file]: ../types/file
[goto-account-login]: ./account#signin
[goto-logout]: #logout
[1]: https://rebilly.github.io/RebillyAPI/#tag/Customer-Authentication%2Fpaths%2F~1authentication-options%2Fget
[2]: https://rebilly.github.io/RebillyAPI/#tag/Customer-Authentication%2Fpaths%2F~1authentication-options%2Fput
[3]: https://rebilly.github.io/RebillyAPI/#tag/Customer-Authentication%2Fpaths%2F~1authentication-tokens%2Fget
[4]: https://rebilly.github.io/RebillyAPI/#tag/Customer-Authentication%2Fpaths%2F~1authentication-tokens~1%7Btoken%7D%2Fget
[5]: https://rebilly.github.io/RebillyAPI/#tag/Customer-Authentication%2Fpaths%2F~1authentication-tokens%2Fpost
[6]: https://rebilly.github.io/RebillyAPI/#tag/Customer-Authentication%2Fpaths%2F~1authentication-tokens~1%7Btoken%7D%2Fdelete
